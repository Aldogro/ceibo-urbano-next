_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[23],{Iljs:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return p})),n.d(t,"c",(function(){return b}));var r=n("nKUr"),a=n("cpVT"),c=n("q1tI"),o=n.n(c),i=n("j7uD");function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){Object(a.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l=o.a.createContext({}),m={promo:{},promos:[],maxDiscount:0},d={CREATE_PROMO:"CREATE_PROMO",SET_PROMO:"SET_PROMO",SET_PROMOS:"SET_PROMOS",GET_MAX_DISCOUNT:"GET_MAX_DISCOUNT"},j=function(e,t){switch(t.type){case d.CREATE_PROMO:var n=(new Date).getTime().toString();return void i.c.firestore().collection("promos").doc(n).set(u(u({},t.payload),{},{id:n})).then((function(){return console.log("promo agregada")})).catch((function(e){return console.log("error al agregar una promo")}));case d.SET_PROMO:return u(u({},e),{},{promo:t.payload});case d.SET_PROMOS:return u(u({},e),{},{promos:t.payload||[]});case d.GET_MAX_DISCOUNT:var r=0;return e.promos.forEach((function(e){e.discount<r&&(r=e.discount)})),u(u({},e),{},{maxDiscount:-1*r});default:throw new Error("Unhandled action type: ".concat(t.type))}},p=function(e){var t=e.children,n=Object(c.useReducer)(j,m),a=n[0],o=n[1];return Object(r.jsx)(l.Provider,{value:[a,o],children:t})},b=function(){return Object(c.useContext)(l)}},jgTA:function(e,t,n){"use strict";var r=n("cpVT"),a=n("nKUr"),c=n("z7pX"),o=n("q1tI"),i=n.n(o),s=n("R/WZ"),u=n("20a2"),l=n("Z3vd"),m=n("tRbT"),d=n("r9w1"),j=n("UhlP"),p=n("ZGBi"),b=n("LnxZ"),O=n("iae6"),f=n("PsDL"),h=n("ytJY"),g=n.n(h),x=n("j7uD"),v=n("ofer");t.a=function(e){var t=e.promo,n=void 0===t?{}:t,r=e.onSubmit,s=Object(o.useState)(""),h=s[0],S=s[1],N=Object(o.useState)(0),y=N[0],E=N[1],T=Object(o.useState)(0),C=T[0],_=T[1],w=Object(o.useState)(""),R=w[0],D=w[1],I=Object(o.useState)(0),k=I[0],M=I[1],U=Object(o.useState)(""),A=U[0],q=U[1],W=Object(o.useState)(!1),z=W[0],G=W[1],X=Object(o.useState)([]),F=X[0],L=X[1],Z=Object(o.useState)([]),B=Z[0],J=Z[1],K=Object(o.useState)(!1),V=K[0],H=K[1],Q=P(),Y=Object(u.useRouter)(),$=function(e){e.preventDefault(),r({name:h,price:+y,partialPrice:+C,cols:R,discount:+k,picture:A,publish:z,products:F,carousel:B})};Object(o.useEffect)((function(){0!==Object.keys(n).length&&(S(n.name),E(+n.price),_(+n.partialPrice),D(+n.cols),M(+n.discount),q(n.picture),G(n.publish),L(n.products),J(n.carousel))}),[n]),Object(o.useEffect)((function(){te()}),[y,F]);var ee=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.length){var n=B;H(!0),t&&q(""),e.forEach((function(e){x.c.storage().ref().child("/images").child(e.name).put(e).then((function(e){return x.c.storage().ref(e.metadata.fullPath).getDownloadURL()})).then((function(e){t?(q(e),H(!1)):(n.push(e),J(Object(c.a)(B)))}))}))}},te=function(){var e=0;F.forEach((function(t){e+=t.price})),M(Math.ceil(100*y/e-100))};return Object(a.jsx)(i.a.Fragment,{children:Object(a.jsxs)("form",{className:Q.root,onSubmit:function(e){return $(e)},noValidate:!0,autoComplete:"off",children:[Object(a.jsxs)(m.a,{container:!0,spacing:3,cols:1,children:[Object(a.jsx)(m.a,{item:!0,xs:12,lg:12,children:Object(a.jsx)(p.a,{control:Object(a.jsx)(j.a,{checked:z,onChange:function(e){var t=e.target;return G(t.checked)},color:"primary"}),label:"Publicar"})}),Object(a.jsx)(m.a,{item:!0,xs:12,md:8,children:Object(a.jsx)(d.a,{className:Q.fullWidth,id:"Name",label:"Nombre",value:h,required:!0,onChange:function(e){var t=e.target;return S(t.value)}})}),Object(a.jsx)(m.a,{item:!0,xs:12,md:4,children:Object(a.jsx)(d.a,{className:Q.fullWidth,id:"cols",label:"Columnas",type:"number",value:R,onChange:function(e){var t=e.target;return D(t.value)}})}),Object(a.jsx)(m.a,{item:!0,xs:12,md:4,children:Object(a.jsx)(d.a,{className:Q.fullWidth,id:"discount",label:"".concat(k||"Descuento"," % - Autom\xe1tico"),disabled:!0})}),Object(a.jsx)(m.a,{item:!0,xs:12,md:4,children:Object(a.jsx)(d.a,{className:Q.fullWidth,id:"Price",label:"Precio",value:y,type:"number",onChange:function(e){var t=e.target;return E(+t.value)}})}),Object(a.jsxs)(m.a,{item:!0,xs:12,md:12,className:Q.products,children:[Object(a.jsx)(v.a,{children:"Productos"}),F.map((function(e,t){return Object(a.jsxs)(m.a,{className:Q.productContainer,container:!0,spacing:1,cols:1,children:[Object(a.jsx)(m.a,{item:!0,xs:12,md:7,children:Object(a.jsx)(d.a,{className:Q.fullWidth,id:"Name",label:e.name||"Nombre",required:!0,onChange:function(e){return function(e,t){var n=F;n[t].name=e.value,L(n)}(e.target,t)}})}),Object(a.jsx)(m.a,{item:!0,xs:12,md:4,children:Object(a.jsx)(d.a,{className:Q.fullWidth,id:"Price",label:e.price||"Precio $",type:"number",onChange:function(e){return function(e,t){var n=F;n[t].price=+e.value,L(n),te()}(e.target,t)}})}),Object(a.jsx)(m.a,{item:!0,xs:12,md:1,children:Object(a.jsx)(f.a,{className:Q.removeProduct,onClick:function(){return function(e){L(F.filter((function(t){return t!==e})))}(e)},children:Object(a.jsx)(g.a,{})})})]},t)})),Object(a.jsx)(l.a,{className:Q.addProduct,color:"primary",onClick:function(){L(F.concat([{name:"Nombre",price:0}]))},children:"Agregar Producto"})]}),Object(a.jsx)(m.a,{item:!0,xs:12,md:6,children:Object(a.jsx)(b.a,{acceptedFiles:["image/*"],filesLimit:1,maxFileSize:1e7,dropzoneText:"Imagen principal",onChange:function(e){return ee(e,!0)},onDelete:function(){return q("")}})}),Object(a.jsx)(m.a,{item:!0,xs:6,className:Q.contain,children:!A&&V?Object(a.jsx)(O.a,{}):Object(a.jsx)("img",{className:Q.image,src:A,alt:"promo image"})}),Object(a.jsx)(m.a,{item:!0,xs:12,md:12,children:Object(a.jsx)(b.a,{acceptedFiles:["image/*"],filesLimit:10,maxFileSize:1e7,dropzoneText:"Im\xe1genes para el carrusel",onChange:function(e){return ee(e)}})}),Object(a.jsxs)(m.a,{item:!0,xs:12,md:12,children:[Object(a.jsx)(v.a,{children:"Im\xe1genes del carrusel"}),B?B.map((function(e){return Object(a.jsxs)("div",{className:Q.carouselImageContainer,children:[Object(a.jsx)(f.a,{className:Q.removeCarouselImage,onClick:function(){return function(e){J(B.filter((function(t){return t!==e})))}(e)},children:Object(a.jsx)(g.a,{})}),Object(a.jsx)("img",{className:Q.carouselImage,src:e})]},e)})):null]})]}),Object(a.jsxs)(m.a,{item:!0,xs:12,className:Q.actions,children:[Object(a.jsx)(l.a,{className:Q.floatRight,variant:"contained",type:"submit",color:"primary",children:"Guardar"}),Object(a.jsx)(l.a,{className:Q.floatRight,variant:"contained",color:"secondary",onClick:function(){return Y.push("/promos")},children:"Cancelar"})]})]})})};var P=Object(s.a)((function(e){return{actions:{margin:e.spacing("20px",0)},contain:{marginTop:"auto",marginBottom:"auto",textAlign:"center"},image:{maxHeight:"250px"},fullWidth:{width:"100%"},floatRight:{minWidth:120,float:"right",marginLeft:16},productContainer:{padding:e.spacing(0,2),"&:nth-child(even)":{background:e.palette.lightGreen.main}},addProduct:{marginTop:e.spacing(2),float:"right"},removeProduct:Object(r.a)({color:e.palette.error.light,float:"right",paddingRight:0},e.breakpoints.up("sm"),{paddingRight:1}),carouselImageContainer:{height:"100px",display:"inline-block",position:"relative"},carouselImage:{padding:e.spacing(2),height:"100px"},removeCarouselImage:{color:e.palette.error.main,position:"absolute",top:5,right:5}}}))},mwgd:function(e,t,n){"use strict";n.r(t);var r=n("cpVT"),a=n("nKUr"),c=n("xvhg"),o=n("q1tI"),i=n.n(o),s=n("20a2"),u=n("Iljs"),l=n("R/WZ"),m=n("NKQG"),d=n("p7UQ"),j=n("jgTA"),p=n("Ji2X"),b=n("ofer"),O=n("j7uD");t.default=function(){var e=Object(u.c)(),t=Object(c.a)(e,2),n=t[0],r=t[1],l=f(),h=Object(s.useRouter)(),g=Object(m.b)(),x=g.enqueueSnackbar;g.closeSnackbar;Object(o.useEffect)((function(){var e=h.query.id;h.query.id&&v(e)}),[h.query]);var v=function(e){Object(O.g)({collection:"promos",id:e}).then((function(e){r({type:u.a.SET_PROMO,payload:e.data()})}))};return Object(a.jsxs)(i.a.Fragment,{children:[Object(a.jsx)(d.a,{}),Object(a.jsxs)(p.a,{className:l.container,children:[Object(a.jsx)(b.a,{className:l.title,variant:"h4",children:"Editar Promos"}),null!==n&&void 0!==n&&n.promo?Object(a.jsx)(j.a,{onSubmit:function(e){return function(e){Object(O.e)({collection:"promos",id:h.query.id,data:e}).then((function(){x("Se ha editado la promo correctamente",{variant:"success"}),h.push("/promos")})).catch((function(e){return x("Ha ocurrido un error",{variant:"error"})}))}(e)},promo:n.promo}):null]})]})};var f=Object(l.a)((function(e){return{container:{margin:e.spacing("70px","auto")},title:Object(r.a)({marginTop:"1rem",marginBottom:"1rem",fontSize:"18px"},e.breakpoints.up("sm"),{marginTop:"2rem",marginBottom:"1rem",fontSize:"24px"})}}))},sUPp:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/promos/[id]/edit",function(){return n("mwgd")}])}},[["sUPp",1,2,4,5,0,3,7,6,8,9,10,11]]]);