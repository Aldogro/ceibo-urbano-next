_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[23],{gVY3:function(e,t,r){"use strict";r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return p})),r.d(t,"c",(function(){return j}));var n=r("nKUr"),a=r("cpVT"),c=r("q1tI"),i=r.n(c);r("5Mca");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){Object(a.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var u=i.a.createContext({}),l={promo:{},promos:[],maxDiscount:0},m={SET_PROMO:"SET_PROMO",SET_PROMOS:"SET_PROMOS",GET_MAX_DISCOUNT:"GET_MAX_DISCOUNT"},d=function(e,t){switch(t.type){case m.SET_PROMO:return s(s({},e),{},{promo:t.payload});case m.SET_PROMOS:return s(s({},e),{},{promos:t.payload||[]});case m.GET_MAX_DISCOUNT:var r=0;return e.promos.forEach((function(e){e.discount<r&&(r=e.discount)})),s(s({},e),{},{maxDiscount:-1*r});default:throw new Error("Unhandled action type: ".concat(t.type))}},p=function(e){var t=e.children,r=Object(c.useReducer)(d,l),a=r[0],i=r[1];return Object(n.jsx)(u.Provider,{value:[a,i],children:t})},j=function(){return Object(c.useContext)(u)}},iTZM:function(e,t,r){"use strict";var n=r("cpVT"),a=r("nKUr"),c=r("vJKn"),i=r.n(c),o=r("z7pX"),s=r("rg98"),u=r("q1tI"),l=r.n(u),m=r("R/WZ"),d=r("20a2"),p=r("Z3vd"),j=r("tRbT"),b=r("r9w1"),f=r("UhlP"),O=r("ZGBi"),h=r("LnxZ"),g=r("iae6"),x=r("PsDL"),v=r("ytJY"),P=r.n(v),y=r("5Mca"),N=r("ofer");t.a=function(e){var t=e.promo,r=void 0===t?{}:t,n=e.onSubmit,c=Object(u.useState)(""),m=c[0],v=c[1],w=Object(u.useState)(0),T=w[0],C=w[1],E=Object(u.useState)(0),_=E[0],k=E[1],R=Object(u.useState)(""),M=R[0],I=R[1],D=Object(u.useState)(0),q=D[0],U=D[1],W=Object(u.useState)(""),z=W[0],G=W[1],X=Object(u.useState)(!1),Z=X[0],A=X[1],F=Object(u.useState)([]),J=F[0],K=F[1],L=Object(u.useState)([]),V=L[0],H=L[1],B=Object(u.useState)(!1),Y=B[0],Q=B[1],$=S(),ee=Object(d.useRouter)(),te=function(e){e.preventDefault(),n({name:m,price:+T,partialPrice:+_,cols:M,discount:+q,picture:z,publish:Z,products:J,carousel:V})};Object(u.useEffect)((function(){0!==Object.keys(r).length&&(v(r.name),C(+r.price),k(+r.partialPrice),I(+r.cols),U(+r.discount),G(r.picture),A(r.publish),K(r.products),H(r.carousel))}),[r]),Object(u.useEffect)((function(){ne()}),[T,J]);var re=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.length){var r=V;Q(!0),t&&G(""),e.forEach(function(){var e=Object(s.a)(i.a.mark((function e(n){var a,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.c.storage().ref().child("/images").child(n.name).put(n);case 2:return a=e.sent,e.next=5,y.c.storage().ref(a.metadata.fullPath).getDownloadURL();case 5:c=e.sent,t?(G(c),Q(!1)):(r.push(c),H(Object(o.a)(V)));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},ne=function(){var e=0;J.forEach((function(t){e+=t.price})),U(Math.ceil(100*T/e-100))};return Object(a.jsx)(l.a.Fragment,{children:Object(a.jsxs)("form",{className:$.root,onSubmit:function(e){return te(e)},noValidate:!0,autoComplete:"off",children:[Object(a.jsxs)(j.a,{container:!0,spacing:3,cols:1,children:[Object(a.jsx)(j.a,{item:!0,xs:12,lg:12,children:Object(a.jsx)(O.a,{control:Object(a.jsx)(f.a,{checked:Z,onChange:function(e){var t=e.target;return A(t.checked)},color:"primary"}),label:"Publicar"})}),Object(a.jsx)(j.a,{item:!0,xs:12,md:8,children:Object(a.jsx)(b.a,{className:$.fullWidth,id:"Name",label:"Nombre",value:m,required:!0,onChange:function(e){var t=e.target;return v(t.value)}})}),Object(a.jsx)(j.a,{item:!0,xs:12,md:4,children:Object(a.jsx)(b.a,{className:$.fullWidth,id:"cols",label:"Columnas",type:"number",value:M,onChange:function(e){var t=e.target;return I(t.value)}})}),Object(a.jsx)(j.a,{item:!0,xs:12,md:4,children:Object(a.jsx)(b.a,{className:$.fullWidth,id:"discount",label:"".concat(q||"Descuento"," % - Autom\xe1tico"),disabled:!0})}),Object(a.jsx)(j.a,{item:!0,xs:12,md:4,children:Object(a.jsx)(b.a,{className:$.fullWidth,id:"Price",label:"Precio",value:T,type:"number",onChange:function(e){var t=e.target;return C(+t.value)}})}),Object(a.jsxs)(j.a,{item:!0,xs:12,md:12,className:$.products,children:[Object(a.jsx)(N.a,{children:"Productos"}),J.map((function(e,t){return Object(a.jsxs)(j.a,{className:$.productContainer,container:!0,spacing:1,cols:1,children:[Object(a.jsx)(j.a,{item:!0,xs:12,md:7,children:Object(a.jsx)(b.a,{className:$.fullWidth,id:"Name",label:e.name||"Nombre",required:!0,onChange:function(e){return function(e,t){var r=J;r[t].name=e.value,K(r)}(e.target,t)}})}),Object(a.jsx)(j.a,{item:!0,xs:12,md:4,children:Object(a.jsx)(b.a,{className:$.fullWidth,id:"Price",label:e.price||"Precio $",type:"number",onChange:function(e){return function(e,t){var r=J;r[t].price=+e.value,K(r),ne()}(e.target,t)}})}),Object(a.jsx)(j.a,{item:!0,xs:12,md:1,children:Object(a.jsx)(x.a,{className:$.removeProduct,onClick:function(){return function(e){K(J.filter((function(t){return t!==e})))}(e)},children:Object(a.jsx)(P.a,{})})})]},t)})),Object(a.jsx)(p.a,{className:$.addProduct,color:"primary",onClick:function(){K(J.concat([{name:"Nombre",price:0}]))},children:"Agregar Producto"})]}),Object(a.jsx)(j.a,{item:!0,xs:12,md:6,children:Object(a.jsx)(h.a,{acceptedFiles:["image/*"],filesLimit:1,maxFileSize:1e7,dropzoneText:"Imagen principal",onChange:function(e){return re(e,!0)},onDelete:function(){return G("")}})}),Object(a.jsx)(j.a,{item:!0,xs:6,className:$.contain,children:!z&&Y?Object(a.jsx)(g.a,{}):Object(a.jsx)("img",{className:$.image,src:z,alt:"promo image"})}),Object(a.jsx)(j.a,{item:!0,xs:12,md:12,children:Object(a.jsx)(h.a,{acceptedFiles:["image/*"],filesLimit:10,maxFileSize:1e7,dropzoneText:"Im\xe1genes para el carrusel",onChange:function(e){return re(e)}})}),Object(a.jsxs)(j.a,{item:!0,xs:12,md:12,children:[Object(a.jsx)(N.a,{children:"Im\xe1genes del carrusel"}),V?V.map((function(e){return Object(a.jsxs)("div",{className:$.carouselImageContainer,children:[Object(a.jsx)(x.a,{className:$.removeCarouselImage,onClick:function(){return function(e){H(V.filter((function(t){return t!==e})))}(e)},children:Object(a.jsx)(P.a,{})}),Object(a.jsx)("img",{className:$.carouselImage,src:e})]},e)})):null]})]}),Object(a.jsxs)(j.a,{item:!0,xs:12,className:$.actions,children:[Object(a.jsx)(p.a,{className:$.floatRight,variant:"contained",type:"submit",color:"primary",children:"Guardar"}),Object(a.jsx)(p.a,{className:$.floatRight,variant:"contained",color:"secondary",onClick:function(){return ee.push("/promos")},children:"Cancelar"})]})]})})};var S=Object(m.a)((function(e){return{actions:{margin:e.spacing("20px",0)},contain:{marginTop:"auto",marginBottom:"auto",textAlign:"center"},image:{maxHeight:"250px"},fullWidth:{width:"100%"},floatRight:{minWidth:120,float:"right",marginLeft:16},productContainer:{padding:e.spacing(0,2),"&:nth-child(even)":{background:e.palette.lightGreen.main}},addProduct:{marginTop:e.spacing(2),float:"right"},removeProduct:Object(n.a)({color:e.palette.error.light,float:"right",paddingRight:0},e.breakpoints.up("sm"),{paddingRight:1}),carouselImageContainer:{height:"100px",display:"inline-block",position:"relative"},carouselImage:{padding:e.spacing(2),height:"100px"},removeCarouselImage:{color:e.palette.error.main,position:"absolute",top:5,right:5}}}))},nqHr:function(e,t,r){"use strict";r.r(t);var n=r("cpVT"),a=r("nKUr"),c=r("vJKn"),i=r.n(c),o=r("rg98"),s=r("xvhg"),u=r("q1tI"),l=r.n(u),m=r("20a2"),d=r("gVY3"),p=r("R/WZ"),j=r("NKQG"),b=r("g009"),f=r("iTZM"),O=r("Ji2X"),h=r("ofer"),g=r("5Mca");t.default=function(){var e=Object(d.c)(),t=Object(s.a)(e,2),r=t[0],n=t[1],c=x(),p=Object(m.useRouter)(),v=Object(j.b)(),P=v.enqueueSnackbar;v.closeSnackbar;Object(u.useEffect)((function(){var e=p.query.id;p.query.id&&y(e)}),[p.query]);var y=function(){var e=Object(o.a)(i.a.mark((function e(t){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(g.g)({collection:"promos",id:t});case 3:r=e.sent,n({type:d.a.SET_PROMO,payload:r.data()}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),P("Ha ocurrido un error al obtener la promo",{variant:"error"});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=Object(o.a)(i.a.mark((function e(t){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(g.e)({collection:"promos",id:p.query.id,data:t});case 3:P("Se ha editado la promo correctamente",{variant:"success"}),p.push("/promos"),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),P("Ha ocurrido un error",{variant:"error"});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}();return Object(a.jsxs)(l.a.Fragment,{children:[Object(a.jsx)(b.a,{}),Object(a.jsxs)(O.a,{className:c.container,children:[Object(a.jsx)(h.a,{className:c.title,variant:"h4",children:"Editar Promos"}),null!==r&&void 0!==r&&r.promo?Object(a.jsx)(f.a,{onSubmit:function(e){return N(e)},promo:r.promo}):null]})]})};var x=Object(p.a)((function(e){return{container:{margin:e.spacing("70px","auto")},title:Object(n.a)({marginTop:"1rem",marginBottom:"1rem",fontSize:"18px"},e.breakpoints.up("sm"),{marginTop:"2rem",marginBottom:"1rem",fontSize:"24px"})}}))},sUPp:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/promos/[id]/edit",function(){return r("nqHr")}])}},[["sUPp",1,2,4,5,0,3,7,6,8,9,10,11]]]);